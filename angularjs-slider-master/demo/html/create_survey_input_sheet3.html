<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Survey Creator and Editor</title>
    
    <script src="../js/jsoneditor.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
  	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="http://ajax.cdnjs.com/ajax/libs/json2/20110223/json2.js"></script>
    
  </head>
  <body>
    <h1>Survey Creator and Editor</h1>
    
    <p>This form allows you to take edit or create surveys:</p>
    
    
    <button id='submit'>Submit (console.log)</button>
    <button id='restore'>Restore to Default</button>
    <button id='enable_disable'>Disable/Enable Form</button>
    <span id='valid_indicator'></span>
    
    <div id='editor_holder'></div>
    
    <script>
      // This is the starting value for the editor
      // We will use this to seed the initial editor 
      // and to provide a "Restore to Default" button.
      
      var valueQuestion = [];
      var entered_value = [];
      var starting_value = [
        {
          "Basic Label": "q1",
          "Default Color": "red",
          "Question Prompt": "This is a question?",
          
          valueArray: {                      
              
                name: "Name1",
                action: "nameaction1",
                definition: "definiton1",
                default: true,
                
                synonyms: [{
                        name: "synname1",
                        action: "synaction1",
                        definition: "syndefinition"
   
                    }]
              
            }
        }
      ];
      // Initialize the editor
      var editor = new JSONEditor(document.getElementById('editor_holder'),{
        // Enable fetching schemas via ajax
        ajax: true,
        
        // The schema for the editor
        schema: {
          type: "array",
          title: "Survey Questions",
          items: {
            title: "Question",
            properties: {
              "Question Prompt": {
                type: "string"
              },
              "Default Color": {
                type: "string"
              },
              "Basic Label": {
                type: "string"
              },
              valueArray: {
                  title: "Values",
                  type: "array",

                  
                  items: 
                    {
                      title: "Value",
                      type: "object",
                      properties: {
                        name: {
                          type: "string"
                        },
                        action: {
                          type: "string"
                        },
                        definition: {
                          type: "string"
                        },
                        default: {
                          type: "boolean"
                        },
                        synonyms: {
                          title: "Synonyms",
                          type: "array",

                          items: {
                            title: "synonym",
                            type: "object",
                            properties: {
                                name: {
                                  type: "string"
                                },
                                action: {
                                  type: "string"
                                },
                                definition: {
                                  type: "string"
                                }
                            }
                          }
                        }
                      }
                    }
                }
            }
          }
},

        
        // Seed the form with a starting value
        startval: starting_value,
        
        // Disable additional properties
        no_additional_properties: true,
        
        // Require all properties by default
        required_by_default: true
      });
      


  	var appendToJSONData = function(JSONFile, newJSONData) {
  		console.log(valueQuestion, valueQuestion[0].length, valueQuestion[valueQuestion.length]);
  		console.log(newJSONData["0"]["Question Prompt"]);
      console.log(newJSONData["0"].valueArray.length);
      console.log(newJSONData.length, 
        newJSONData["0"].valueArray.length, 
        newJSONData["0"].valueArray["0"].synonyms.length);
      var newID = new String("000").concat(valueQuestion[0].length.toString());
      
      // var JSON = [{}];
      var JSONArr = new Object({"Questions": []});
      // var questionTemplate = new Array();
      // var valueTemplate = new Array();
      // var synonymTemplate = new Array();
      // JSONArr.push('{');
      // valueQuestion.json.push({
        // JSON.push({'{'});
        
        for(var questionIndex = 0; questionIndex < newJSONData.length; questionIndex++) {
  			   // var questionTemplate[questionIndex]["id"] = newID;
           // var Questions = new Array();
            var questionTemplate = {
              "id": newID,
              "Question": newJSONData[questionIndex]["Question Prompt"],
              "defaultColor": newJSONData[questionIndex]["defaultColor"],
              "BasicLabel":newJSONData[questionIndex]["defaultColor"],
              "AnswerValue":"",
              "href":newJSONData[questionIndex]["href"],
              "AnswerKeyWords":"",
              "ValueOptions": {
                "value": []}
              };
            
           JSONArr["Questions"][questionIndex] = questionTemplate; 
	         // JSONArr["Questions"].push(questionTemplate);
           console.log(questionTemplate, JSONArr);
           // JSONArr[questionIndex]['Question'] = newJSONData[questionIndex]["Question Prompt"];
           // JSONArr[questionIndex]["Question"].push(newJSONData[questionIndex]["Question Prompt"]);
	         // "ValueOptions":{
            for(var valueIndex = 0; valueIndex < newJSONData[questionIndex].valueArray.length; valueIndex++) {
	            // var ValueOptions = new Object();
               var valueTemplate = {
                  "name": newJSONData[questionIndex].valueArray[valueIndex].name,
                  "action": newJSONData[questionIndex].valueArray[valueIndex].action,
                  "definition": newJSONData[questionIndex].valueArray[valueIndex].definition,
                  "default": newJSONData[questionIndex].valueArray[valueIndex].default,
                  "synonyms": {
                    "synonym":[]}
                  }
                            

              // JSON[questionIndex]["ValueOptions"][valueIndex].name = newJSONData[questionIndex].valueArray[valueIndex].name;
              // JSON[questionIndex]["ValueOptions"][valueIndex].action = newJSONData[questionIndex].valueArray[valueIndex].action;
              // JSON[questionIndex]["ValueOptions"][valueIndex].definition = newJSONData[questionIndex].valueArray[valueIndex].definition;
              // JSON[questionIndex]["ValueOptions"][valueIndex].default = newJSONData[questionIndex].valueArray[valueIndex].default;
              // "value":[
	               // {
	                  // "name":"Dread",
	                  // "action":"You are Full of Dread",
	                  // "definition":"Dry mouth; heart racing; trembling",
	                  // "default":false,
              JSONArr["Questions"][questionIndex]["ValueOptions"]["value"][valueIndex] = valueTemplate;
              console.log(JSONArr);
              for(var synonymIndex = 0; synonymIndex < newJSONData[questionIndex].valueArray[valueIndex].synonyms.length; synonymIndex++) {
                
                 var synonymTemplate = {
                  "name": newJSONData[questionIndex].valueArray[valueIndex].synonyms[synonymIndex].name,
                  "action": newJSONData[questionIndex].valueArray[valueIndex].synonyms[synonymIndex].action
                };
                  // JSON[questionIndex]["ValueOptions"][valueIndex]["synonyms"][synonymIndex].name = newJSONData[questionIndex].valueArray[valueIndex].synonyms[synonymIndex].name;

                  // JSON[questionIndex]["ValueOptions"][valueIndex]["synonyms"][synonymIndex].action = newJSONData[questionIndex].valueArray[valueIndex].synonyms[synonymIndex].action;
              
               // console.log(synonymTemplate);
              // var synonyms = {
              //     "synonyms": synonymTemplate   
              // };
              
              JSONArr["Questions"][questionIndex]["ValueOptions"]["value"][valueIndex]["synonyms"]["synonym"][synonymIndex] = synonymTemplate;
              console.log(JSONArr);
              // synonyms.push(synonymTemplate);
              }
              
              
	         //          "synonyms":{
	         //             "synonym":[
	         //                {
	         //                   "name":"Panic",
	         //                   "action":"You are Panicking"
	         //                },
	         //                {
	         //                   "name":"Distressed",
	         //                   "action":"You are Distressed"
	         //                }
	         //             ]
	         //          }
	         //       }
	         //    ]
          //   }
	         // },
           
           // console.log(valueTemplate);
          // ValueOptions = {
          //     value  
          // }
          // valueTemplate.push(synonyms);
          // ValueOptions.push(valueTemplate);
        }
        // questionTemplate.push(ValueOptions);
        
            
        // var extraQuestionDetails = {
        //   "defaultColor": newJSONData[questionIndex]["defaultColor"],
        //   "BasicLabel":newJSONData[questionIndex]["defaultColor"],
        //   "AnswerValue":"",
        //   "href":newJSONData[questionIndex]["href"],
        //   "AnswerKeyWords":""
        // }
        // JSONArr["Questions"][questionIndex].push(extraQuestionDetails);
            // JSON[questionIndex]["defaultColor"] = newJSONData[questionIndex]["defaultColor"];  
            // JSON[questionIndex]["BasicLabel"] = newJSONData[questionIndex]["defaultColor"];  
            // JSON[questionIndex]["AnswerValue"] = "";
            // JSON[questionIndex]["href"] = newJSONData[questionIndex]["href"];  
            // JSON[questionIndex]["AnswerKeyWords"] = "";  
	         // "defaultColor":"green",
	         // "BasicLabel":"Courage",
	         // "AnswerValue":"",
	         // "href": "#/first",
	         // "AnswerKeyWords":""	
         
	  		// });
        // questionTemplate.push(extraQuestionDetails);
        // Questions.push(questionTemplate);

        // JSONArr.push(Questions);
        // console.log(questionTemplate);
        // console.log(extraQuestionDetails);
  	   }
       // JSONArr.push('}');
       // var ach = JSON.stringify(["1", "2", "3"]);
       var returnJSON = JSON.stringify(JSONArr);
       console.log(JSONArr);
       console.log(returnJSON);

       // console.log(returnJSON);
     }

      // Hook up the submit button to log to the console
      document.getElementById('submit').addEventListener('click',function() {
        // Get the value from the editor
        entered_value = editor.getValue();
        console.log("Editor empty", editor.getValue());
        console.log("Starting val", starting_value);
        console.log("questions_id", valueQuestion);
        entered_value = editor.getValue();
        appendToJSONData(valueQuestion, entered_value);

      });
      
      // Hook up the Restore to Default button
      document.getElementById('restore').addEventListener('click',function() {
        editor.setValue(starting_value);
      });
      
      // Hook up the enable/disable button
      document.getElementById('enable_disable').addEventListener('click',function() {
        // Enable form
        if(!editor.isEnabled()) {
          editor.enable();
        }
        // Disable form
        else {
          editor.disable();
        }
      });
    
    loadJSON = function() {
	
	var returnJSON = [];
	$.getJSON("../json/questions.json", function(json) {
	  $.each(json.Questions, function(k, v) {
	    // console.log(k, v);
	  })
	  valueQuestion.push(json.Questions);
	  // $scope.valueQuestion = json.Questions[0].Question;
	  // return json;
	});
	// console.log($scope.valueQuestion);   
	}

	loadJSON();

      // Hook up the validation indicator to update its 
      // status whenever the editor changes
      editor.on('change',function() {
        // Get an array of errors from the validator
        var errors = editor.validate();
        
        var indicator = document.getElementById('valid_indicator');
        
        // Not valid
        if(errors.length) {
          indicator.style.color = 'red';
          indicator.textContent = "not valid";
        }
        // Valid
        else {
          indicator.style.color = 'green';
          indicator.textContent = "valid";
        }
      });
    </script>
  </body>
</html>
